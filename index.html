<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <title>Mapa okresů ČR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // Import from data.csv (word, region)
    let csvData = [];
    fetch('data.csv')
        .then(response => response.text())
        .then(text => {
            const lines = text.split('\n');
            for (let line of lines) {
                const [word, region] = line.split(',');
                if (word && region) { // Ensure both values exist
                    csvData.push({word: word.trim(), region: region.trim()});
                }
            }
        });

    fetch('data.csv')
        .then(response => response.text())
        .then(text => {
            const lines = text.split('\n');
            let csvData = [];
            for (let line of lines) {
                const [word, region] = line.split(',');
                if (word && region) {
                    csvData.push({word: word.trim(), region: region.trim()});
                }
            }

            let moreUsedWordInRegion = {};
            csvData.forEach(entry => {
                const {word, region} = entry;
                if (!moreUsedWordInRegion[region]) {
                    moreUsedWordInRegion[region] = {};
                }
                if (!moreUsedWordInRegion[region][word]) {
                    moreUsedWordInRegion[region][word] = 0;
                }
                moreUsedWordInRegion[region][word]++;
            });

            console.log(moreUsedWordInRegion);
        });


    function wordToColor(region) {
        const colors = {
            'dýl': '#1f77b4',
            'později': '#d62728'
        };
        const regionData = csvData.filter(entry => entry.region === region);
        let counts = {};
        regionData.forEach(entry => {
            if (!counts[entry.word]) {
                counts[entry.word] = 0;
            }
            counts[entry.word]++;
        });
        let maxWord = null;
        let maxCount = 0;
        for (let word in counts) {
            if (counts[word] > maxCount) {
                maxCount = counts[word];
                maxWord = word;
            }
        }
        return colors[maxWord] || '#cccccc';
    }

    function toolbindHTML(region) {
        const regionData = csvData.filter(entry => entry.region === region);
        let counts = {};
        regionData.forEach(entry => {
            if (!counts[entry.word]) {
                counts[entry.word] = 0;
            }
            counts[entry.word]++;
        });
        let html = `<strong>${region}</strong><br/>`;
        for (let word in counts) {
            html += `${word}: ${counts[word]}<br/>`;
        }
        return html;
    }

    // Initialize map
    const map = L.map('map').setView([49.8, 15.5], 7);

    // Add base layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Load Czech okresy GeoJSON
    fetch('okresy.json')
        .then(r => r.json())
        .then(data => {
            L.geoJSON(data, {
                style: feature => ({
                    color: '#333',
                    weight: 1,
                    fillColor: wordToColor(feature.name),
                    fillOpacity: 0.3
                }),
                onEachFeature: (feature, layer) => {
                    const name = feature.name;
                    layer.bindTooltip(toolbindHTML(name));
                    layer.on('click', () => {
                        alert('Clicked: ' + name);
                    });
                    layer.on('mouseover', () => layer.setStyle({fillOpacity: 0.6}));
                    layer.on('mouseout', () => layer.setStyle({fillOpacity: 0.3}));
                }
            }).addTo(map);
        });
</script>
</body>
</html>
